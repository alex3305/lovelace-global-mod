(()=>{var d=class{#e;get darkMode(){return(this.#e??this.update()).themes.darkMode}get hass(){return this.#e??this.update()}get themeName(){return(this.#e??this.update()).themes.theme}get themes(){return(this.#e??this.update()).themes.themes}async update(){await Promise.race([customElements.whenDefined("home-assistant"),customElements.whenDefined("hc-main")]);let e=customElements.get("home-assistant")?"home-assistant":"hc-main";return this.#e=await new Promise(t=>{let s=()=>{document.querySelector(e)?.hass?t(document.querySelector(e)?.hass):setTimeout(s)};s()}),this.#e}};var p="global-mod",f="0.3.0";var h=class n{#e;#t=[];#s=[];constructor(){this.#e=new d,this.#e.update().then(()=>{Promise.all([this.loadConfig(),this.addEventListeners()])})}static get Current(){return window.location.pathname.toLowerCase()}static get EditMode(){return window.location.search.includes("?edit=1")}static get Name(){return p}static get Version(){return f}get theme(){let e=this.#e.themes,t=this.#e.themeName;return Object.hasOwn(e,`${t}-${n.Name}`)?(console.warn(`Theme still uses the deprecated ${n.Name}-suffix.`),e[`${t}-${n.Name}`]):e[t]}async addEventListener(e,t,s){e?.addEventListener(t,s,!1)}async addEventListeners(){let e=()=>{document.hidden||this.applyStyles()};Promise.all([this.addEventListener(window,"location-changed",e),this.addEventListener(window,"popstate",e),this.addEventListener(document,"visibilitychange",e),this.addEventListener(document.body,"click",e),this.addEventListener(document.querySelector("hc-main"),"settheme",e),this.addEventListener(document.querySelector("home-assistant"),"settheme",e)])}async applyStyle(e,t=void 0){if(!n.Current.includes(e.path.toLowerCase())||n.EditMode&&e.disabledOnEdit){t?.remove();return}t===void 0&&(t=await this.createStyleElement(e));try{let s=await this.findElement(document.body,`home-assistant$${e.selector}`);s&&!s.contains(t)&&Promise.all([s.append(t),this.#s.push(t)])}catch(s){console.error(`Error while applying style: ${s}`)}}async applyStyles(){this.#t.forEach(e=>{this.applyStyle(e,this.#s.find(t=>t.classList?.contains(e.name)))})}async createRule(e,t){let s=t.substring(0,t.lastIndexOf("-"));return{name:s,selector:e[t],path:e[s+"-path"]||"/",style:e[s+"-style"]||"",disabledOnEdit:e[s+"-disable-on-edit"]||!1,darkStyle:e[s+"-style-dark"],lightStyle:e[s+"-style-light"]}}async createStyleElement(e){let t=document.createElement("style");return t.classList?.add(n.Name),t.classList?.add(e.name),t.setAttribute("style","display:none;"),(async()=>!e.darkStyle&&!e.lightStyle?t.textContent=e.style:t.textContent=e.style+" "+(this.#e.darkMode?e.darkStyle:e.lightStyle))(),t}async loadConfig(){let e=this.theme;this.#t=await Promise.all(Object.keys(e).filter(t=>t.includes("-selector")).map(t=>this.createRule(e,t)).map(t=>((async()=>this.applyStyle(await t))(),t))),!this.#t||this.#t.size==0?console.info("%c Global mod %c loaded without any config...","color:white;background:purple;","","color:black;background:lightblue;",""):console.info(`%c Global Mod %c ${n.Version} `,"color:white;background:purple;","color:white;background:darkgreen;")}async findElement(e,t){let s=t.trim().split("$");for(let r of s)e=await this.waitForElement(e,r);return e}waitForElement(e,t,s=10,r=0){let m={childList:!0,subtree:!0},l=null;return new Promise((a,g)=>{if(t===""){if(e.shadowRoot)return a(e.shadowRoot)}else if(l=e.querySelector(t)||e.shadowRoot?.querySelector(t),l)return a(l);let o=new MutationObserver(w=>{if(t===""){if(e.shadowRoot)return o.disconnect(),clearTimeout(c),a(e.shadowRoot)}else for(let b of w.filter(i=>i.type==="childList"))for(let i of b.addedNodes){if(i.nodeType===Node.ELEMENT_NODE&&i.matches(t))return o.disconnect(),clearTimeout(c),a(i);if(i.shadowRoot){let u=i.shadowRoot.querySelector(t);if(u)return o.disconnect(),clearTimeout(c),a(u);o.observe(i.shadowRoot,m)}}});o.observe(e,m);let c=setTimeout(()=>(o.disconnect(),r<10?a(this.waitForElement(e,t,s,++r)):g(new Error(`Element not found for ${t} in ${e.tagName}`))),s*r)})}};new h;})();
