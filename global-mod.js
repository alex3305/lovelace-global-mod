(()=>{var c="global-mod",h="0.3.0";var l=class o{static instance;#e;#t;#s;constructor(){console.time("Component Load"),this.#s=[],this.refreshHomeAssistant(),Promise.all([this.loadConfig(),this.addEventListeners()]),console.timeEnd("Component Load")}static get Current(){return window.location.pathname.toLowerCase()}static get EditMode(){return o.Current.includes("?edit=1")}static get Name(){return c}static get Version(){return h}get darkMode(){return this.#e.themes.darkMode}async addEventListeners(){window.addEventListener("location-changed",()=>setTimeout(()=>this.applyStyles()),!1),window.addEventListener("popstate",()=>this.applyStyles(),!1),document.addEventListener("visibilitychange",()=>{document.hidden||this.applyStyles()},!1),document.body.addEventListener("click",()=>this.applyStyles(),!1),document.querySelector("hc-main")?.addEventListener("settheme",()=>{this.refreshHomeAssistant(),this.applyStyles()},!1),document.querySelector("home-assistant")?.addEventListener("settheme",()=>{this.refreshHomeAssistant(),this.applyStyles()},!1)}async createStyleElement(e){let n=document.createElement("style");return n.classList?.add(o.Name),n.setAttribute("type","text/css"),n.setAttribute("style","display:none;"),n.textContent+=e.style,(e.darkStyle!==void 0||e.lightStyle!==void 0)&&(n.textContent+=this.darkMode?e.darkStyle:e.lightStyle),n}async applyStyle(e,n,a,i,s=void 0){if(!a.includes(n.path.toLowerCase())){s!==void 0&&s.remove();return}if(!(i&&n.disabledOnEdit)){s===void 0&&(s=await this.createStyleElement(n),s?.classList?.add(e));try{let t=await this.selectTree(`home-assistant$${n.selector}`,1,9);t.contains(s)||(t.appendChild(s),this.#s.push(s))}catch{console.error(`Could not create rule ${e} after multiple tries...`)}}}async applyStyles(){let e=o.Current,n=o.EditMode;for await(let[a,i]of this.#t){let s=this.#s.find(t=>t.classList?.contains(a));this.applyStyle(a,i,e,n,s)}}async loadConfig(){let e=`${this.#e.themes.theme}-${o.Name}`;e in this.#e.themes.themes?console.warn(`Theme still uses the deprecated ${o.Name}-suffix.`):e=`${this.#e.themes.theme}`;let n=this.#e.themes.themes[e];this.#t=await this.loadRules(n),!this.#t||this.#t.size==0?console.info(`%c Global mod %c loaded without any config... 
  \u{1F449} Add a 'mods' section to your theme %c ${e} %c to enable modding.`,"color:white;background:purple;","","color:black;background:lightblue;",""):console.info(`%c Global Mod %c ${o.Version} `,"color:white;background:purple;","color:white;background:darkgreen;")}async loadRules(e){let n=o.Current,a=o.EditMode,i=new Map;for await(var s of Object.keys(e).filter(t=>t.includes("-selector"))){let t=s.substring(0,s.lastIndexOf("-")),r={selector:e[s],path:e[t+"-path"]||"/",style:e[t+"-style"]||"",disabledOnEdit:e[t+"-disable-on-edit"]||!1,darkStyle:e[t+"-style-dark"],lightStyle:e[t+"-style-light"]};i.set(t,r),this.applyStyle(t,r,n,a)}return i}refreshHomeAssistant(){this.#e=document.querySelector("home-assistant").hass}async selectTree(e,n,a){let i=e.split("$"),s;try{for(let t=0;t<i.length;t++)i[t]&&(s=s?s.querySelector(i[t]):document.querySelector(i[t]),t+1<i.length&&(s=s.shadowRoot));if(!s)throw new Error;return s}catch{if(console.warn(`Retry for ${e}`),n===a)throw new Error(`No Element Found for ${e}`);return await new Promise(t=>setTimeout(t,n*10)),await this.selectTree(e,n+1,a)}}};new l;})();
